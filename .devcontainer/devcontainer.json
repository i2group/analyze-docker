// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/javascript-node
{
  "name": "Node.js",
  "build": {
    // We use a Dockerfile. More info: https://containers.dev/guide/dockerfile
    "dockerfile": "Dockerfile"
  },
  // Features to add to the dev container. More info: https://containers.dev/features.
  "features": {
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers-contrib/features/apt-get-packages:1": {
      "packages": "gnupg2"
    },
    "ghcr.io/dhoeric/features/hadolint:1": {},
    "ghcr.io/devcontainers-contrib/features/circleci-cli:1": {},
    "ghcr.io/devcontainers/features/docker-outside-of-docker:1": {}
  },

  // Use 'forwardPorts' to make a list of ports inside the container available locally.
  // "forwardPorts": [],

  // After the container is created, we make links from the container's home directory
  // to all the user's personal ~/.something files. This is useful for tools like Git
  // etc so that the dev container accesses the same configuration that the user is used to.
  // We need special handling of the .ssh directory, as it needs to be copied instead of linked.
  "postCreateCommand": "( ( cd /userhome && find . -mindepth 1 -maxdepth 1 -name '.*' -print | sort | cut -c 3- ) | while IFS= read -r FILE; do ( cd && rm -rf \"${FILE}\" && ln -sf \"/userhome/${FILE}\" ); done && if [ -d /userhome/.ssh ]; then rm -rf ~/.ssh && cp -pr /userhome/.ssh ~; fi ) && ( cd .circleci/dynamic && npm install --omit=dev )",

  // Configure tool-specific properties.
  "customizations": {
    "vscode": {
      "extensions": [
        "CircleCI.circleci",
        "timonwong.shellcheck",
        "eamodio.gitlens",
        "streetsidesoftware.code-spell-checker",
        "foxundermoon.shell-format",
        "mhutchie.git-graph",
        "esbenp.prettier-vscode",
        "GitHub.vscode-pull-request-github",
        "ms-vscode-remote.remote-wsl",
        "dbaeumer.vscode-eslint",
        "exiasr.hadolint",
        "GitHub.copilot"
      ]
    }
  },
  "workspaceMount": "source=${localWorkspaceFolder},target=${localWorkspaceFolder},type=bind,consistency=cached",
  "workspaceFolder": "${localWorkspaceFolder}",
  "mounts": [
    "source=/mnt,target=/mnt,type=bind",
    "source=${localEnv:HOME},target=/userhome/,type=bind"
  ]

  // Uncomment to connect as root instead. More info: https://aka.ms/dev-containers-non-root.
  // "remoteUser": "root"
}
